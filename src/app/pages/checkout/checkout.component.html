<div class="checkout-container">
  <!-- Header -->
  <div class="checkout-header">
    <h1>Finaliser la commande</h1>
    <nav class="breadcrumb">
      <a routerLink="/cart">Panier</a> &gt;
      <span class="current">Checkout</span>
    </nav>
  </div>

  <!-- Progress Bar -->
  <div class="checkout-progress">
    <div class="progress-bar">
      <div class="progress-fill" [style.width]="getProgressWidth()"></div>
    </div>
    <div class="progress-steps">
      <div class="step" [class]="getStepStatus('shipping')">
        <span class="step-number">1</span>
        <span class="step-label">Livraison</span>
      </div>
      <div class="step" [class]="getStepStatus('payment')">
        <span class="step-number">2</span>
        <span class="step-label">Paiement</span>
      </div>
      <div class="step" [class]="getStepStatus('review')">
        <span class="step-number">3</span>
        <span class="step-label">Confirmation</span>
      </div>
    </div>
  </div>

  <div class="checkout-content">
    <!-- Main Form -->
    <div class="checkout-form-section">
      <form [formGroup]="checkoutForm" (ngSubmit)="placeOrder()">
        
        <!-- Step 1: Shipping -->
        <div *ngIf="currentStep === 'shipping'" class="form-step">
          <h2>Adresse de livraison</h2>
          
          <div formGroupName="shippingAddress" class="address-form">
            <div class="form-row">
              <div class="form-group">
                <label>Pr√©nom *</label>
                <input type="text" formControlName="firstName" class="form-input">
                <div *ngIf="checkoutForm.get('shippingAddress.firstName')?.invalid && checkoutForm.get('shippingAddress.firstName')?.touched" class="error-message">
                  Pr√©nom requis
                </div>
              </div>
              <div class="form-group">
                <label>Nom *</label>
                <input type="text" formControlName="lastName" class="form-input">
                <div *ngIf="checkoutForm.get('shippingAddress.lastName')?.invalid && checkoutForm.get('shippingAddress.lastName')?.touched" class="error-message">
                  Nom requis
                </div>
              </div>
            </div>

            <div class="form-group">
              <label>Adresse *</label>
              <input type="text" formControlName="street" class="form-input" placeholder="Num√©ro et rue">
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Ville *</label>
                <input type="text" formControlName="city" class="form-input">
              </div>
              <div class="form-group">
                <label>Code postal *</label>
                <input type="text" formControlName="zipCode" class="form-input">
                <div *ngIf="checkoutForm.get('shippingAddress.zipCode')?.invalid && checkoutForm.get('shippingAddress.zipCode')?.touched" class="error-message">
                  Code postal invalide
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Pays *</label>
                <select formControlName="country" class="form-input">
                  <option value="France">France</option>
                  <option value="Belgique">Belgique</option>
                  <option value="Suisse">Suisse</option>
                  <option value="Luxembourg">Luxembourg</option>
                </select>
              </div>
              <div class="form-group">
                <label>T√©l√©phone</label>
                <input type="tel" formControlName="phone" class="form-input">
              </div>
            </div>
          </div>

          <!-- Shipping Method -->
          <div class="shipping-methods">
            <h3>Mode de livraison</h3>
            <div class="method-options">
              <label *ngFor="let method of shippingOptions" class="method-option">
                <input 
                  type="radio" 
                  formControlName="shippingMethod" 
                  [value]="method.id"
                  (change)="onShippingMethodChange()"
                  class="method-radio"
                >
                <div class="method-info">
                  <span class="method-name">{{ method.name }}</span>
                  <span class="method-details">{{ method.days }}</span>
                  <span class="method-price" [class.free]="method.price === 0">
                    {{ method.price === 0 ? 'Gratuit' : method.price + ' ‚Ç¨' }}
                  </span>
                </div>
              </label>
            </div>
          </div>

          <!-- Same Address Toggle -->
          <div class="same-address-toggle">
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                formControlName="useSameAddress"
                (change)="onUseSameAddressChange()"
              >
              Utiliser la m√™me adresse pour la facturation
            </label>
          </div>

          <!-- Billing Address (conditionnel) -->
          <div *ngIf="!checkoutForm.get('useSameAddress')?.value" class="billing-address">
            <h3>Adresse de facturation</h3>
            <div formGroupName="billingAddress" class="address-form">
              <!-- M√™me structure que shipping address -->
              <div class="form-row">
                <div class="form-group">
                  <label>Pr√©nom *</label>
                  <input type="text" formControlName="firstName" class="form-input">
                </div>
                <div class="form-group">
                  <label>Nom *</label>
                  <input type="text" formControlName="lastName" class="form-input">
                </div>
              </div>
              <!-- ... autres champs ... -->
            </div>
          </div>

          <div class="step-actions">
            <button type="button" (click)="goToStep('payment')" class="btn-primary" [disabled]="!checkoutForm.get('shippingAddress')?.valid">
              Continuer vers le paiement
            </button>
          </div>
        </div>

        <!-- Step 2: Payment -->
        <div *ngIf="currentStep === 'payment'" class="form-step">
          <h2>Moyen de paiement</h2>
          
          <div formGroupName="paymentMethod">
            <div class="payment-methods">
              <label *ngFor="let method of paymentMethods" class="payment-option">
                <input 
                  type="radio" 
                  formControlName="method" 
                  [value]="method.id"
                  class="payment-radio"
                >
                <span class="payment-icon">{{ method.icon }}</span>
                <span class="payment-name">{{ method.name }}</span>
              </label>
            </div>

            <!-- Card Details (conditionnel) -->
            <div *ngIf="checkoutForm.get('paymentMethod.method')?.value === 'card'" class="card-details">
              <div class="form-group">
                <label>Num√©ro de carte *</label>
                <input type="text" formControlName="cardNumber" class="form-input" placeholder="1234 5678 9012 3456">
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Date d'expiration *</label>
                  <input type="text" formControlName="expiryDate" class="form-input" placeholder="MM/AA">
                </div>
                <div class="form-group">
                  <label>CVV *</label>
                  <input type="text" formControlName="cvv" class="form-input" placeholder="123">
                </div>
              </div>
              <div class="form-group">
                <label>Titulaire de la carte *</label>
                <input type="text" formControlName="cardholder" class="form-input" placeholder="Jean Dupont">
              </div>
            </div>
          </div>

          <div class="step-actions">
            <button type="button" (click)="currentStep = 'shipping'" class="btn-secondary">
              ‚Üê Retour
            </button>
            <button type="button" (click)="goToStep('review')" class="btn-primary" [disabled]="!checkoutForm.get('paymentMethod')?.valid">
              V√©rifier la commande
            </button>
          </div>
        </div>

        <!-- Step 3: Review -->
        <div *ngIf="currentStep === 'review'" class="form-step">
          <h2>R√©capitulatif de la commande</h2>
          
          <!-- Order Summary -->
          <div class="order-summary">
            <div class="summary-section">
              <h3>Adresse de livraison</h3>
              <div class="summary-content">
                <p>{{ checkoutForm.get('shippingAddress.firstName')?.value }} {{ checkoutForm.get('shippingAddress.lastName')?.value }}</p>
                <p>{{ checkoutForm.get('shippingAddress.street')?.value }}</p>
                <p>{{ checkoutForm.get('shippingAddress.zipCode')?.value }} {{ checkoutForm.get('shippingAddress.city')?.value }}</p>
                <p>{{ checkoutForm.get('shippingAddress.country')?.value }}</p>
              </div>
            </div>

            <div class="summary-section">
              <h3>Mode de livraison</h3>
              <div class="summary-content">
                <p>{{ getSelectedShippingOption()?.name }}</p>
                <p>{{ getSelectedShippingOption()?.days }}</p>
              </div>
            </div>

            <div class="summary-section">
              <h3>Paiement</h3>
              <div class="summary-content">
                <p>{{ getPaymentMethodName() }}</p>
              </div>
            </div>
          </div>

          <!-- Terms -->
          <div class="terms-section">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="termsAccepted">
              J'accepte les <a href="#" class="link">conditions g√©n√©rales de vente</a> et la <a href="#" class="link">politique de confidentialit√©</a> *
            </label>
          </div>

          <div class="step-actions">
            <button type="button" (click)="currentStep = 'payment'" class="btn-secondary">
              ‚Üê Retour
            </button>
            <button type="submit" class="btn-primary" [disabled]="!checkoutForm.valid || isLoading">
              <span *ngIf="!isLoading">Confirmer la commande</span>
              <span *ngIf="isLoading" class="loading-text">Traitement en cours...</span>
            </button>
          </div>
        </div>
      </form>
    </div>

    <!-- Order Summary Sidebar -->
    <div class="order-summary-sidebar">
      <div class="summary-card">
        <h3>Votre commande</h3>
        
        <!-- Products List -->
        <div class="order-items">
          <div *ngFor="let item of cartItems" class="order-item">
            <img [src]="item.image" [alt]="item.name" class="item-image">
            <div class="item-details">
              <span class="item-name">{{ item.name }}</span>
              <span class="item-quantity">Quantit√©: {{ item.quantity }}</span>
            </div>
            <span class="item-price">{{ (item.price * item.quantity) | number:'1.2-2' }} ‚Ç¨</span>
          </div>
        </div>

        <!-- Totals -->
        <div class="order-totals">
          <div class="total-line">
            <span>Sous-total</span>
            <span>{{ subtotal | number:'1.2-2' }} ‚Ç¨</span>
          </div>
          <div class="total-line">
            <span>Livraison</span>
            <span>{{ shipping | number:'1.2-2' }} ‚Ç¨</span>
          </div>
          <div class="total-line total">
            <strong>Total</strong>
            <strong>{{ total | number:'1.2-2' }} ‚Ç¨</strong>
          </div>
        </div>

        <!-- Security Badges -->
        <div class="security-badges">
          <div class="badge">üîí Paiement s√©curis√©</div>
          <div class="badge">‚úì Garantie satisfait ou rembours√©</div>
        </div>
      </div>
    </div>
  </div>
</div>