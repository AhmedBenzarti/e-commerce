<div class="product-detail-container" *ngIf="product; else notFound">
  <!-- Breadcrumb -->
  <nav class="breadcrumb">
    <a routerLink="/">Accueil</a> &gt;
    <a routerLink="/products">Boutique</a> &gt;
    <a [routerLink]="['/products']" [queryParams]="{category: product.category}">{{ product.category }}</a> &gt;
    <span class="current">{{ product.name }}</span>
  </nav>

  <div class="product-main">
    <!-- Gallery Section -->
    <div class="product-gallery">
      <div class="main-image">
        <img [src]="selectedImage" [alt]="product.name" class="product-main-image">
        <div class="image-badges">
          <span *ngIf="product.isOnSale && discountPercent > 0" class="badge sale-badge">
            -{{ discountPercent }}%
          </span>
          <span *ngIf="!product.inStock" class="badge out-of-stock-badge">
            Rupture
          </span>
        </div>
      </div>
      <div class="image-thumbnails">
        <img 
        *ngFor="let image of product.images; let i = index" 
        [src]="image" 
        [alt]="product.name + ' vue ' + (i + 1)"
        [class.active]="selectedImage === image"
        (click)="selectImage(image)"
        class="thumbnail"
        >
      </div>
    </div>

    <!-- Product Info -->
    <div class="product-info">
      <div class="product-header">
        <!-- Seller Info -->
        <div class="seller-info">
          <span class="seller-label">Vendeur :</span>
          <span class="seller-name">{{ product.seller.name }}</span>
          <div class="seller-rating">
            <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
            <span class="rating">({{ product.seller.rating }})</span>
          </div>
          <button class="contact-seller-btn">Contacter</button>
        </div>

        <!-- Category & Brand -->
        <div class="product-meta">
          <span class="product-category">{{ product.category }}</span>
          <span class="product-brand">Marque : {{ product.brand }}</span>
          <span class="product-sku">R√©f: {{ product.sku }}</span>
        </div>

        <!-- Product Title -->
        <h1 class="product-title">{{ product.name }}</h1>

        <!-- Rating -->
        <div class="product-rating-main">
          <div class="rating-stars">
            <span class="filled">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
            <span class="empty">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
          </div>
          <span class="rating-value">{{ product.rating }}/5</span>
          <span class="review-count">({{ product.reviewCount }} avis)</span>
          <a href="#reviews" class="see-reviews">Voir les avis</a>
        </div>

        <!-- Price -->
        <div class="product-price-main">
          <span class="current-price">{{ product.price }} ‚Ç¨</span>
          <span *ngIf="product.originalPrice && product.originalPrice > product.price" 
                class="original-price">
            {{ product.originalPrice }} ‚Ç¨
          </span>
          <span *ngIf="discountPercent > 0" class="discount-save">
            √âconomisez {{ (product.originalPrice! - product.price) | number:'1.2-2' }} ‚Ç¨
          </span>
        </div>

        <!-- Stock Status -->
        <div class="stock-status" [class]="getStockStatusClass()">
          {{ getStockStatus() }}
        </div>

        <!-- Short Description -->
        <p class="product-short-description">
          {{ product.description }}
        </p>

        <!-- Features -->
        <div class="product-features">
          <h3>Points forts :</h3>
          <ul>
            <li *ngFor="let feature of product.features">{{ feature }}</li>
          </ul>
        </div>
      </div>

      <!-- Add to Cart Section -->
      <div class="add-to-cart-section" *ngIf="product.inStock">
        <div class="quantity-selector">
          <label>Quantit√© :</label>
          <div class="quantity-controls">
            <button (click)="decreaseQuantity()" class="quantity-btn">-</button>
            <span class="quantity-display">{{ quantity }}</span>
            <button (click)="increaseQuantity()" class="quantity-btn">+</button>
          </div>
          <span class="stock-info" *ngIf="product.stockQuantity < 20">
            {{ product.stockQuantity }} disponible(s)
          </span>
        </div>

        <div class="action-buttons">
          <button (click)="addToCart()" class="add-to-cart-btn primary">
            üõí Ajouter au panier
          </button>
          <button class="buy-now-btn secondary">
            ‚ö° Acheter maintenant
          </button>
        </div>

        <div class="secondary-actions">
          <button (click)="addToWishlist()" class="wishlist-btn">
            ‚ô° Ajouter aux favoris
          </button>
          <button (click)="shareProduct()" class="share-btn">
            üì§ Partager
          </button>
        </div>

        <div class="delivery-info">
          <div class="delivery-item">
            <span class="icon">üöö</span>
            <span>Livraison gratuite d√®s 50‚Ç¨</span>
          </div>
          <div class="delivery-item">
            <span class="icon">‚Ü©Ô∏è</span>
            <span>Retour gratuit sous 30 jours</span>
          </div>
          <div class="delivery-item">
            <span class="icon">üîí</span>
            <span>Paiement s√©curis√©</span>
          </div>
        </div>
      </div>

      <!-- Out of Stock Message -->
      <div class="out-of-stock-message" *ngIf="!product.inStock">
        <h3>Produit en rupture de stock</h3>
        <p>Ce produit n'est actuellement pas disponible.</p>
        <button class="notify-btn">Me pr√©venir quand disponible</button>
      </div>
    </div>
  </div>

  <!-- Product Tabs -->
  <div class="product-tabs">
    <div class="tab-headers">
      <button 
        [class.active]="activeTab === 'description'"
        (click)="setActiveTab('description')"
        class="tab-header"
      >
        Description
      </button>
      <button 
        [class.active]="activeTab === 'specifications'"
        (click)="setActiveTab('specifications')"
        class="tab-header"
      >
        Sp√©cifications
      </button>
      <button 
        [class.active]="activeTab === 'reviews'"
        (click)="setActiveTab('reviews')"
        class="tab-header"
      >
        Avis ({{ product.reviewCount }})
      </button>
      <button 
        [class.active]="activeTab === 'shipping'"
        (click)="setActiveTab('shipping')"
        class="tab-header"
      >
        Livraison & Retours
      </button>
    </div>

    <div class="tab-content">
      <!-- Description Tab -->
      <div *ngIf="activeTab === 'description'" class="tab-pane description-tab">
        <h3>Description compl√®te</h3>
        <p>{{ product.fullDescription }}</p>
        
        <div class="key-benefits">
          <h4>Avantages principaux :</h4>
          <div class="benefits-grid">
            <div *ngFor="let feature of product.features" class="benefit-item">
              <span class="benefit-icon">‚úì</span>
              <span>{{ feature }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Specifications Tab -->
      <div *ngIf="activeTab === 'specifications'" class="tab-pane specifications-tab">
        <h3>Caract√©ristiques techniques</h3>
        <div class="specs-table">
          <div *ngFor="let spec of getSpecifications()" class="spec-row">
            <div class="spec-name">{{ spec.key }}</div>
            <div class="spec-value">{{ spec.value }}</div>
          </div>
        </div>
      </div>

      <!-- Reviews Tab -->
      <div *ngIf="activeTab === 'reviews'" class="tab-pane reviews-tab" id="reviews">
        <div class="reviews-header">
          <div class="overall-rating">
            <h3>Avis clients</h3>
            <div class="rating-summary">
              <div class="average-rating">
                <span class="rating-number">{{ averageRating }}</span>
                <span class="rating-stars-large">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                <span class="total-reviews">{{ product.reviewCount }} avis</span>
              </div>
            </div>
          </div>
          <button class="add-review-btn">√âcrire un avis</button>
        </div>

        <div class="reviews-list">
          <div *ngFor="let review of reviews" class="review-item">
            <div class="review-header">
              <div class="reviewer-info">
                <span class="reviewer-name">{{ review.user }}</span>
                <span *ngIf="review.verified" class="verified-badge">‚úì Achat v√©rifi√©</span>
              </div>
              <div class="review-rating">
                <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                <span class="review-date">{{ review.date | date:'dd/MM/yyyy' }}</span>
              </div>
            </div>
            <p class="review-comment">{{ review.comment }}</p>
          </div>
        </div>
      </div>

      <!-- Shipping Tab -->
      <div *ngIf="activeTab === 'shipping'" class="tab-pane shipping-tab">
        <h3>Livraison et retours</h3>
        
        <div class="shipping-info">
          <h4>Options de livraison :</h4>
          <div class="shipping-options">
            <div class="shipping-option">
              <strong>Livraison standard</strong>
              <span>Gratuite d√®s 50‚Ç¨ d'achat</span>
              <span>2-3 jours ouvr√©s</span>
            </div>
            <div class="shipping-option">
              <strong>Livraison express</strong>
              <span>9.90‚Ç¨</span>
              <span>24h</span>
            </div>
          </div>
        </div>

        <div class="returns-info">
          <h4>Politique de retours :</h4>
          <ul>
            <li>Retour gratuit sous 30 jours</li>
            <li>Produit doit √™tre dans son √©tat d'origine</li>
            <li>Emballage d'origine requis</li>
            <li>Remboursement sous 14 jours</li>
          </ul>
        </div>

        <div class="faq-section">
          <h4>Questions fr√©quentes :</h4>
          <div *ngFor="let faq of faqs" class="faq-item">
            <div class="faq-question">{{ faq.question }}</div>
            <div class="faq-answer">{{ faq.answer }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Related Products -->
  <div class="related-products" *ngIf="relatedProducts.length > 0">
    <h2>Produits similaires</h2>
    <div class="related-grid">
      <app-product-card
        *ngFor="let relatedProduct of relatedProducts"
        [product]="relatedProduct"
        [layout]="'grid'"
        [showActions]="true"
        class="related-product-item"
      ></app-product-card>
    </div>
  </div>
</div>

<ng-template #notFound>
  <div class="not-found">
    <h2>Produit non trouv√©</h2>
    <p>Le produit que vous recherchez n'existe pas ou a √©t√© supprim√©.</p>
    <button routerLink="/products" class="back-to-products">
      ‚Üê Retour √† la boutique
    </button>
  </div>
</ng-template>